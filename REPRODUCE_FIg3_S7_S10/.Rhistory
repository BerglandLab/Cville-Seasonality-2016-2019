eol = "\n", na = "NA", dec = ".", row.names = FALSE,
col.names = TRUE, qmethod = c("escape", "double"),
fileEncoding = "")
library(vroom)
metadat <- vroom("/Users/jcbnunez/Documents/GitHub/Cville-Seasonality-2016-2019/pub.Tables_and_Sup_Tables/parts/TableS1.data/DEST_parts/DEST1.metadat.csv")
metadat
sampsused <- vroom("/Users/jcbnunez/Documents/GitHub/Cville-Seasonality-2016-2019/pub.Tables_and_Sup_Tables/parts/TableS1.data/DEST_parts/DEST1.sampsUsed.txt")
sampsused <- vroom("/Users/jcbnunez/Documents/GitHub/Cville-Seasonality-2016-2019/pub.Tables_and_Sup_Tables/parts/TableS1.data/DEST_parts/DEST1.sampsUsed.txt", delim = "\t")
sampsused
library(tidyverse)
metadat
sampsused
left_join(sampsused, metadat)
names(metadat)
left_join(sampsused, metadat) %>%
dplyr::select("In(2L)t", propSimNorm, )
metadat
sampsused
left_join(sampsused, metadat) %>%
dplyr::select(sampleId, "In(2L)t", propSimNorm, )
left_join(sampsused, metadat) %>%
dplyr::select(sampleId, "In(2L)t", propSimNorm, sex )
write.table(dat.tab, file = "dest.dat.tab.txt",
append = FALSE, quote = F, sep = "\t",
eol = "\n", na = "NA", dec = ".", row.names = F,
col.names = TRUE, qmethod = c("escape", "double"),
fileEncoding = "")
left_join(sampsused, metadat) %>%
dplyr::select(sampleId, "In(2L)t", propSimNorm, sex ) ->
dat.tab
write.table(dat.tab, file = "dest.dat.tab.txt",
append = FALSE, quote = F, sep = "\t",
eol = "\n", na = "NA", dec = ".", row.names = F,
col.names = TRUE, qmethod = c("escape", "double"),
fileEncoding = "")
getwd()
load("/Users/jcbnunez/Documents/GitHub/Cville-Seasonality-2016-2019/pub.Tables_and_Sup_Tables/parts/TableS1.data/DEST_EC_metadata.Rdata")
ls()
samps_EFFCOV
load("/Users/jcbnunez/Documents/GitHub/Cville-Seasonality-2016-2019/REPRODUCE_FIg2_S4/make.Fig2.panelA.Rdata")
ls()
pca_table_df
pca_table_df %>%
select(sampleId, "In(2L)t" )
pca_table_df %>%
select(sampleId, `In(2L)t` )
pca_table_df %>%
dplyr::select(sampleId, `In(2L)t` )
getwd()
write.table(in2l.dat, file = "Pools.Freqofin2l.dat.txt", append = FALSE, quote = F, sep = "\t",
eol = "\n", na = "NA", dec = ".", row.names = F,
col.names = TRUE, qmethod = c("escape", "double"),
fileEncoding = "")
pca_table_df %>%
dplyr::select(sampleId, `In(2L)t` ) -> in2l.dat
write.table(in2l.dat, file = "Pools.Freqofin2l.dat.txt", append = FALSE, quote = F, sep = "\t",
eol = "\n", na = "NA", dec = ".", row.names = F,
col.names = TRUE, qmethod = c("escape", "double"),
fileEncoding = "")
pca_table_df
in2l.dat
pca_table_df
pca_table_df %>% View
pca_table_df
pca_table_df %>%
filter(year %in% 2016:2018 ) %>%
filter(chr == "2L") %>%
dplyr::select(sampleId, `In(2L)t` ) -> in2l.dat
write.table(in2l.dat, file = "Pools.Freqofin2l.dat.txt", append = FALSE, quote = F, sep = "\t",
eol = "\n", na = "NA", dec = ".", row.names = F,
col.names = TRUE, qmethod = c("escape", "double"),
fileEncoding = "")
31012.61
31012.61-40000
31012.61-4000
40000-31012.61
40000-39012.61
setwd("/Users/jcbnunez/Documents/GitHub/Cville-Seasonality-2016-2019/4.3.Case.Study.Msp300/5.Fst.Msp300.exons")
vroom
library(vroom)
library(tidyverse)
library(vroom)
library(tidyverse)
library(reshape2)
library(magrittr)
fst.dat.msp = vroom("/Users/jcbnunez/Documents/GitHub/Cville-Seasonality-2016-2019/4.3.Case.Study.Msp300/5.Fst.Msp300.exons/sim.mut.haps.fst.windowed.weir.fst")
fst.dat.msp
5.35e6
4.95e6
fst.dat.msp %>%
filter(pos > 4.95e6 & pos < 5.35e6)
fst.dat.msp
fst.dat.msp %>%
filter(BIN_START > 4.95e6 & BIN_END < 5.35e6)
BIN_START BIN_END
fst.dat.msp %>%
filter(BIN_START > 4.95e6 & BIN_END < 5.35e6) %>%
mutate(pos.mid = (BIN_START+BIN_END)/2 )
fst.dat.msp %>%
filter(BIN_START > 4.95e6 & BIN_END < 5.35e6) %>%
mutate(pos.mid = (BIN_START+BIN_END)/2 ) %>%
melt(id = c("CHROM", "BIN_START", "BIN_END", "N_VARIANTS", "pos.mid")) %>%
ggplot(aes(
x=pos.mid,
y=value,
color =variable
)) + geom_line()
fst.dat.msp %>%
filter(BIN_START > 4.95e6 & BIN_END < 5.35e6) %>%
mutate(pos.mid = (BIN_START+BIN_END)/2 ) %>%
melt(id = c("CHROM", "BIN_START", "BIN_END", "N_VARIANTS", "pos.mid")) %>%
ggplot(aes(
x=pos.mid,
y=value,
color =variable
)) + geom_line() +
geom_vline(xintercept = 5192177)
setwd("/Users/jcbnunez/Documents/GitHub/Cville-Seasonality-2016-2019/REPRODUCE_FIg3_S7_S10")
rm(list = ls())
library(tidyverse)
library(magrittr)
library(data.table)
library(reshape2)
library(foreach)
library(doParallel)
library(SNPRelate)
library(SeqArray)
library(vroom)
library(fastglm)
#save(sub_pi_d_parsed.plot, inv.dt, final.windows.pos, file = "dat.for.3b.Rdata")
load("./dat.for.3b.Rdata")
ggplot() +
geom_vline(data=inv.dt[which(inv.dt$invName == "2Lt")], aes(xintercept=start/1e6), linetype="solid") +
geom_vline(data=inv.dt[which(inv.dt$invName == "2Lt")], aes(xintercept=stop/1e6), linetype="solid") +
geom_rect(data = final.windows.pos,
aes(xmin=start/1e6, xmax = end/1e6,
ymin = -0, ymax = 0.01),
alpha = 0.7, fill = "gold") +
geom_line(
data=sub_pi_d_parsed.plot,
aes(
x=BIN_START/1e6,
y=value,
color = type),
alpha = 0.9) +
theme_bw() +
theme(legend.position = "none") +
xlim(0,20.5) +
facet_wrap(~variable, ncol = 1, scales = "free_y") ->
pi_d_plot_all
pi_d_plot_all
ggplot(aes(
x=((BIN_START+BIN_END)/2)/1e6,
y=MEAN_FST,
)) +
geom_line() +
ylab(expression(F[ST])) +
xlab("Genomic Position") +
facet_wrap(~CHROM, scales = "free_x") ->
all.fasts
gff.msp.300 = vroom("gff.msp.300.dat.txt", col_names = F, delim = "\t")
for(i in 1:dim(gff.msp.300)[1] ){
tmp <- gff.msp.300[i,]
tmp.str = str_split(tmp, pattern = "\\|")
isoform = gsub('.+(isoform .).+','\\1',tmp.str[[9]][3])
gff.msp.300$isoform[i] = isoform
}
gff.msp.300$isoform %>% unique()
gff.msp.300 %<>%
mutate(rank = case_when(isoform == "isoform B" ~ -0.001,
isoform == "isoform D" ~ -0.002,
isoform == "isoform E" ~ -0.003,
isoform == "isoform F" ~ -0.004,
isoform == "isoform G" ~ -0.005,
isoform == "isoform H" ~ -0.006,
isoform == "isoform I" ~ -0.007,
isoform == "isoform J" ~ -0.008,
isoform == "isoform K" ~ -0.009,
isoform == "isoform L" ~ -0.010,
isoform == "isoform M" ~ -0.011
))
#####
fst.cm %>%
filter(CHROM != "X") %>%
ggplot(aes(
x=((BIN_START+BIN_END)/2)/1e6,
y=MEAN_FST,
)) +
geom_line() +
ylab(expression(F[ST])) +
xlab("Genomic Position") +
facet_wrap(~CHROM, scales = "free_x") ->
all.fasts
load("./dat.for.3b.Rdata")
fst <- vroom("inv.vs.std.cm.fst.windowed.weir.fst")
fst %>%
filter(CHROM == "2L") -> fst.2l.dat
fst.2l.dat %>%
arrange(-MEAN_FST)
final.windows.pos =
data.frame(win.name = c("win_3.1", "win_4.7", "win_5.1", "win_6.1", "win_6.8", "win_9.6" ),
mid = c(3.0, 4.67, 5.15, 6.2, 6.8 , 9.6)
) %>%
mutate(start = (mid-0.2)*1e6 ,
end  = (mid+0.2)*1e6  )
gff.msp.300 = vroom("gff.msp.300.dat.txt", col_names = F, delim = "\t")
for(i in 1:dim(gff.msp.300)[1] ){
tmp <- gff.msp.300[i,]
tmp.str = str_split(tmp, pattern = "\\|")
isoform = gsub('.+(isoform .).+','\\1',tmp.str[[9]][3])
gff.msp.300$isoform[i] = isoform
}
gff.msp.300$isoform %>% unique()
gff.msp.300 %<>%
mutate(rank = case_when(isoform == "isoform B" ~ -0.001,
isoform == "isoform D" ~ -0.002,
isoform == "isoform E" ~ -0.003,
isoform == "isoform F" ~ -0.004,
isoform == "isoform G" ~ -0.005,
isoform == "isoform H" ~ -0.006,
isoform == "isoform I" ~ -0.007,
isoform == "isoform J" ~ -0.008,
isoform == "isoform K" ~ -0.009,
isoform == "isoform L" ~ -0.010,
isoform == "isoform M" ~ -0.011
))
#####
fst.cm %>%
filter(CHROM != "X") %>%
ggplot(aes(
x=((BIN_START+BIN_END)/2)/1e6,
y=MEAN_FST,
)) +
geom_line() +
ylab(expression(F[ST])) +
xlab("Genomic Position") +
facet_wrap(~CHROM, scales = "free_x") ->
all.fasts
fst.cm
fst.cm %>%
filter(CHROM == "2L") ->
fst.all.2L
ls()
rm(list = ls())
library(tidyverse)
library(magrittr)
library(data.table)
library(reshape2)
library(foreach)
library(doParallel)
library(SNPRelate)
library(SeqArray)
library(vroom)
library(fastglm)
ggplot() +
geom_vline(data=inv.dt[which(inv.dt$invName == "2Lt")], aes(xintercept=start/1e6), linetype="solid") +
geom_vline(data=inv.dt[which(inv.dt$invName == "2Lt")], aes(xintercept=stop/1e6), linetype="solid") +
geom_rect(data = final.windows.pos,
aes(xmin=start/1e6, xmax = end/1e6,
ymin = -0, ymax = 0.01),
alpha = 0.7, fill = "gold") +
geom_line(
data=sub_pi_d_parsed.plot,
aes(
x=BIN_START/1e6,
y=value,
color = type),
alpha = 0.9) +
theme_bw() +
theme(legend.position = "none") +
xlim(0,20.5) +
facet_wrap(~variable, ncol = 1, scales = "free_y") ->
pi_d_plot_all
pi_d_plot_all
rm(list = ls())
library(tidyverse)
library(magrittr)
library(data.table)
library(reshape2)
library(foreach)
library(doParallel)
library(SNPRelate)
library(SeqArray)
library(vroom)
library(fastglm)
load("./dat.for.3b.Rdata")
ggplot() +
geom_vline(data=inv.dt[which(inv.dt$invName == "2Lt")], aes(xintercept=start/1e6), linetype="solid") +
geom_vline(data=inv.dt[which(inv.dt$invName == "2Lt")], aes(xintercept=stop/1e6), linetype="solid") +
geom_rect(data = final.windows.pos,
aes(xmin=start/1e6, xmax = end/1e6,
ymin = -0, ymax = 0.01),
alpha = 0.7, fill = "gold") +
geom_line(
data=sub_pi_d_parsed.plot,
aes(
x=BIN_START/1e6,
y=value,
color = type),
alpha = 0.9) +
theme_bw() +
theme(legend.position = "none") +
xlim(0,20.5) +
facet_wrap(~variable, ncol = 1, scales = "free_y") ->
pi_d_plot_all
pi_d_plot_all
fst <- vroom("inv.vs.std.cm.fst.windowed.weir.fst")
fst
fst %>%
filter(CHROM == "2L") -> fst.2l.dat
fst.2l.dat %>%
arrange(-MEAN_FST)
fst %>%
filter(CHROM != "X") %>%
ggplot(aes(
x=((BIN_START+BIN_END)/2)/1e6,
y=MEAN_FST,
)) +
geom_line() +
ylab(expression(F[ST])) +
xlab("Genomic Position") +
facet_wrap(~CHROM, scales = "free_x") ->
all.fasts
all.fasts
fst.cm %>%
filter(CHROM == "2L") ->
fst.all.2L
fst
fst.cm = fst
fst.cm %>%
filter(CHROM == "2L") ->
fst.all.2L
fst.all.2L %>%
filter(BIN_START > 2225744 & BIN_END < 13154180) %>%
summarise(Mean = mean(.$MEAN_FST, na.rm = T),
SD = sd(.$MEAN_FST, na.rm = T))
fst.all.2L %>%
arrange(-MEAN_FST) %>% head
fst.all.2L.w5.1 <- fst.all.2L %>% filter(BIN_START > 5.05e6-1e5 & BIN_END < 5.25e6+1e5)
fst.all.2L %>%
ggplot(aes(
x=(BIN_START+BIN_END)/2,
y=MEAN_FST,
#color = pop,
#linetype = kar
)) +
geom_vline(xintercept = (5190001+5200000 )/2, color = "red" ) +
scale_color_manual(values = colors) +
ylab(expression(paste("Wier and Cockerham ", F[ST] ) )) +
theme_classic() +
xlab("Genomic Position (Mb)") +
geom_line() ->
fst.dat.5
fst.dat.5
ggplot() +
geom_rect(data = gff.msp.300,
aes(xmin=X4, xmax = X5,
ymin = rank-0.0001, ymax = rank+0.0001),
alpha = 0.7, fill = "red") +
geom_text(
data = slice_head(group_by(gff.msp.300, isoform)),
aes(x=5.07e6, y = rank,
label = isoform
), size = 2.5 ) +
theme_classic() +
xlab("Genomic Position (Mb)") +
geom_vline(xintercept = (5170001+5180000 )/2, color = "blue" ) +
geom_vline(xintercept = (5190001+5200000 )/2, color = "red" ) +
xlim(5.05e6-1e5,5.25e6+1e5) ->
msp300.arc
gff.msp.300 = vroom("gff.msp.300.dat.txt", col_names = F, delim = "\t")
for(i in 1:dim(gff.msp.300)[1] ){
tmp <- gff.msp.300[i,]
tmp.str = str_split(tmp, pattern = "\\|")
isoform = gsub('.+(isoform .).+','\\1',tmp.str[[9]][3])
gff.msp.300$isoform[i] = isoform
}
gff.msp.300$isoform %>% unique()
gff.msp.300 %<>%
mutate(rank = case_when(isoform == "isoform B" ~ -0.001,
isoform == "isoform D" ~ -0.002,
isoform == "isoform E" ~ -0.003,
isoform == "isoform F" ~ -0.004,
isoform == "isoform G" ~ -0.005,
isoform == "isoform H" ~ -0.006,
isoform == "isoform I" ~ -0.007,
isoform == "isoform J" ~ -0.008,
isoform == "isoform K" ~ -0.009,
isoform == "isoform L" ~ -0.010,
isoform == "isoform M" ~ -0.011
))
ggplot() +
geom_rect(data = gff.msp.300,
aes(xmin=X4, xmax = X5,
ymin = rank-0.0001, ymax = rank+0.0001),
alpha = 0.7, fill = "red") +
geom_text(
data = slice_head(group_by(gff.msp.300, isoform)),
aes(x=5.07e6, y = rank,
label = isoform
), size = 2.5 ) +
theme_classic() +
xlab("Genomic Position (Mb)") +
geom_vline(xintercept = (5170001+5180000 )/2, color = "blue" ) +
geom_vline(xintercept = (5190001+5200000 )/2, color = "red" ) +
xlim(5.05e6-1e5,5.25e6+1e5) ->
msp300.arc
msp300.arc
fst.dat.5
fst.all.2L %>%
ggplot(aes(
x=(BIN_START+BIN_END)/2,
y=MEAN_FST,
#color = pop,
#linetype = kar
)) +
geom_vline(xintercept = (5190001+5200000 )/2, color = "red" ) +
scale_color_manual(values = colors) +
ylab(expression(paste("Wier and Cockerham ", F[ST] ) )) +
theme_classic() +
xlab("Genomic Position (Mb)") +
geom_line() ->
fst.dat.5
fst.dat.5/msp300.arc
fst.all.2L
fst.all.2L %>%
filter(BIN_START > 4.96e6 &  BIN_END < 5.35e6 ) %>%
ggplot(aes(
x=(BIN_START+BIN_END)/2,
y=WEIGHTED_FST,
#color = pop,
#linetype = kar
)) +
geom_vline(xintercept = 5192177, color = "red" ) +
scale_color_manual(values = colors) +
ylab(expression(paste("Wier and Cockerham ", F[ST] ) )) +
theme_classic() +
xlab("Genomic Position (Mb)") +
geom_line()
fst.all.2L %>% arrgange
fst.all.2L %>%
arrange(WEIGHTED_FST)
fst.all.2L %>%
arrange(-WEIGHTED_FST)
fst.all.2L %>%
filter(BIN_START > 4.96e6 &  BIN_END < 5.35e6 ) %>%
arrange(-WEIGHTED_FST)
5170001-5195000
5170001-5200000
fst.all.2L %>%
filter(BIN_START > 4.96e6 &  BIN_END < 5.35e6 ) %>%
ggplot(aes(
x=(BIN_START+BIN_END)/2,
y=WEIGHTED_FST,
#color = pop,
#linetype = kar
)) +
geom_vline(xintercept = 5192177, color = "red" ) +
scale_color_manual(values = colors) +
ylab(expression(paste("Wier and Cockerham ", F[ST] ) )) +
theme_classic() +
xlab("Genomic Position (Mb)") +
geom_line() -> fst.dat.tsp.win
fst.dat.tsp.win
fst.all.2L %>%
filter(BIN_START > 4.96e6 &  BIN_END < 5.35e6 ) %>%
ggplot(aes(
x=(BIN_START+BIN_END)/2,
y=WEIGHTED_FST,
#color = pop,
#linetype = kar
)) +
geom_vline(xintercept = 5192177, color = "red" ) +
geom_hline(yintercept = 0.6, color = "blue", lintype = "dashed" ) +
scale_color_manual(values = colors) +
ylab(expression(paste("Wier and Cockerham ", F[ST] ) )) +
theme_classic() +
xlab("Genomic Position (Mb)") +
geom_line() -> fst.dat.tsp.win
fst.all.2L %>%
filter(BIN_START > 4.96e6 &  BIN_END < 5.35e6 ) %>%
ggplot(aes(
x=(BIN_START+BIN_END)/2,
y=WEIGHTED_FST,
#color = pop,
#linetype = kar
)) +
geom_vline(xintercept = 5192177, color = "red" ) +
geom_hline(yintercept = 0.6, color = "blue", linetype = "dashed" ) +
scale_color_manual(values = colors) +
ylab(expression(paste("Wier and Cockerham ", F[ST] ) )) +
theme_classic() +
xlab("Genomic Position (Mb)") +
geom_line() -> fst.dat.tsp.win
fst.dat.tsp.win
fst.all.2L %>%
filter(BIN_START > 4.96e6 &  BIN_END < 5.35e6 ) %>%
arrange(-WEIGHTED_FST)
##### msp300 fig
fst.all.2L %>%
filter(BIN_START > 4.96e6 &  BIN_END < 5.35e6 ) %>%
arrange(-WEIGHTED_FST) %>%
filter(WEIGHTED_FST > 0.6)
left_join(glm.cville.0, win.snp.annots) %>%
filter(col == "missense_variant") %>%
filter(rnp < 0.05) %>%
group_by(pos) %>%
slice_head() %>%
mutate(tsp.mel = 5192177,
tsp.sim = 4996892) %>%
as.data.frame() %>%
mutate(diff.to.tsp = 5192177-pos)
