aes(x=modRank.in2lt, y=(rr), #shape=inv
), color = "grey",
#position=position_dodge2(width=.5),
size=2, alpha = 0.6) +
geom_linerange(data=
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "temp.max"][mod == 2],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
color = sig
),alpha = 0.7, size = 1.5
#position=position_dodge2(width=.5)
) +
geom_point(data =
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "temp.max"][mod == 2],
aes(x=modRank.in2lt, y=(rr), #shape=inv
fill = sig),
#position=position_dodge2(width=.5),
size=3, alpha = 1.0, shape = 21) +
geom_linerange(data=
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "null"],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
color = sig
),alpha = 0.7, size = 1.5
#position=position_dodge2(width=.5)
) +
geom_point(data =
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "null"],
aes(x=modRank.in2lt, y=(rr), #shape=inv
fill = sig),
#position=position_dodge2(width=.5),
size=3, alpha = 1.0, shape = 22) +
geom_linerange(data=
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "pop_year"],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
color = sig
),alpha = 0.7, size = 1.5
#position=position_dodge2(width=.5)
) +
geom_point(data =
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "pop_year"],
aes(x=modRank.in2lt, y=(rr), #shape=inv
fill = sig),
#position=position_dodge2(width=.5),
size=3, alpha = 1.0, shape = 24) +
facet_grid(inv~chr) +
theme_bw() +
geom_hline(yintercept=1) +
xlab("Model") +
theme(axis.text.x=element_blank()) +
scale_y_continuous(trans = "log2")
#aic.en.plot <-
ggplot() +
geom_linerange(data = o2.ag.ranked[!is.na(sig)][order(!sig)],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
),color = "grey", alpha = 0.5,
#position=position_dodge2(width=.5)
) +
geom_linerange(data=
o2.ag.ranked[sig == TRUE][order(!sig)],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
#color = sig
),alpha = 0.7, size = 0.8, color = "blue"
#position=position_dodge2(width=.5)
) +
geom_point(data = o2.ag.ranked[sig == TRUE][order(!sig)],
aes(x=modRank.in2lt, y=(rr), #shape=inv
), color = "grey",
#position=position_dodge2(width=.5),
size=2, alpha = 0.6) +
geom_point(data = o2.ag.ranked[!is.na(sig)][order(!sig)],
aes(x=modRank.in2lt, y=(rr), #shape=inv
), color = "blue",
#position=position_dodge2(width=.5),
size=2, alpha = 0.6) +
geom_linerange(data=
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "temp.max"][mod == 2],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
color = sig
),alpha = 0.7, size = 1.5
#position=position_dodge2(width=.5)
) +
geom_point(data =
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "temp.max"][mod == 2],
aes(x=modRank.in2lt, y=(rr), #shape=inv
fill = sig),
#position=position_dodge2(width=.5),
size=3, alpha = 1.0, shape = 21) +
geom_linerange(data=
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "null"],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
color = sig
),alpha = 0.7, size = 1.5
#position=position_dodge2(width=.5)
) +
geom_point(data =
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "null"],
aes(x=modRank.in2lt, y=(rr), #shape=inv
fill = sig),
#position=position_dodge2(width=.5),
size=3, alpha = 1.0, shape = 22) +
geom_linerange(data=
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "pop_year"],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
color = sig
),alpha = 0.7, size = 1.5
#position=position_dodge2(width=.5)
) +
geom_point(data =
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "pop_year"],
aes(x=modRank.in2lt, y=(rr), #shape=inv
fill = sig),
#position=position_dodge2(width=.5),
size=3, alpha = 1.0, shape = 24) +
facet_grid(inv~chr) +
theme_bw() +
geom_hline(yintercept=1) +
xlab("Model") +
theme(axis.text.x=element_blank()) +
scale_y_continuous(trans = "log2")
#aic.en.plot <-
ggplot() +
geom_linerange(data = o2.ag.ranked[!is.na(sig)][order(!sig)],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
),color = "grey", alpha = 0.5,
#position=position_dodge2(width=.5)
) +
geom_linerange(data=
o2.ag.ranked[sig == TRUE][order(!sig)],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
#color = sig
),alpha = 0.7, size = 0.8, color = "blue"
#position=position_dodge2(width=.5)
) +
geom_point(data = o2.ag.ranked[sig == TRUE][order(!sig)],
aes(x=modRank.in2lt, y=(rr), #shape=inv
), color = "blue",
#position=position_dodge2(width=.5),
size=2, alpha = 0.6) +
geom_point(data = o2.ag.ranked[!is.na(sig)][order(!sig)],
aes(x=modRank.in2lt, y=(rr), #shape=inv
), color = "grey",
#position=position_dodge2(width=.5),
size=2, alpha = 0.6) +
geom_linerange(data=
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "temp.max"][mod == 2],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
color = sig
),alpha = 0.7, size = 1.5
#position=position_dodge2(width=.5)
) +
geom_point(data =
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "temp.max"][mod == 2],
aes(x=modRank.in2lt, y=(rr), #shape=inv
fill = sig),
#position=position_dodge2(width=.5),
size=3, alpha = 1.0, shape = 21) +
geom_linerange(data=
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "null"],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
color = sig
),alpha = 0.7, size = 1.5
#position=position_dodge2(width=.5)
) +
geom_point(data =
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "null"],
aes(x=modRank.in2lt, y=(rr), #shape=inv
fill = sig),
#position=position_dodge2(width=.5),
size=3, alpha = 1.0, shape = 22) +
geom_linerange(data=
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "pop_year"],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
color = sig
),alpha = 0.7, size = 1.5
#position=position_dodge2(width=.5)
) +
geom_point(data =
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "pop_year"],
aes(x=modRank.in2lt, y=(rr), #shape=inv
fill = sig),
#position=position_dodge2(width=.5),
size=3, alpha = 1.0, shape = 24) +
facet_grid(inv~chr) +
theme_bw() +
geom_hline(yintercept=1) +
xlab("Model") +
theme(axis.text.x=element_blank()) +
scale_y_continuous(trans = "log2")
#aic.en.plot <-
ggplot() +
geom_linerange(data = o2.ag.ranked[!is.na(sig)][order(!sig)],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
),color = "grey", alpha = 0.5,
#position=position_dodge2(width=.5)
) +
geom_linerange(data=
o2.ag.ranked[sig == TRUE][order(!sig)],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
#color = sig
),alpha = 0.7, size = 0.8, color = "blue"
#position=position_dodge2(width=.5)
) +
geom_point(data = o2.ag.ranked[!is.na(sig)][order(!sig)],
aes(x=modRank.in2lt, y=(rr), #shape=inv
), color = "grey",
#position=position_dodge2(width=.5),
size=2, alpha = 0.6) +
geom_point(data = o2.ag.ranked[sig == TRUE][order(!sig)],
aes(x=modRank.in2lt, y=(rr), #shape=inv
), color = "blue",
#position=position_dodge2(width=.5),
size=2, alpha = 0.6) +
geom_linerange(data=
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "temp.max"][mod == 2],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
color = sig
),alpha = 0.7, size = 1.5
#position=position_dodge2(width=.5)
) +
geom_point(data =
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "temp.max"][mod == 2],
aes(x=modRank.in2lt, y=(rr), #shape=inv
fill = sig),
#position=position_dodge2(width=.5),
size=3, alpha = 1.0, shape = 21) +
geom_linerange(data=
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "null"],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
color = sig
),alpha = 0.7, size = 1.5
#position=position_dodge2(width=.5)
) +
geom_point(data =
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "null"],
aes(x=modRank.in2lt, y=(rr), #shape=inv
fill = sig),
#position=position_dodge2(width=.5),
size=3, alpha = 1.0, shape = 22) +
geom_linerange(data=
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "pop_year"],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
color = sig
),alpha = 0.7, size = 1.5
#position=position_dodge2(width=.5)
) +
geom_point(data =
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "pop_year"],
aes(x=modRank.in2lt, y=(rr), #shape=inv
fill = sig),
#position=position_dodge2(width=.5),
size=3, alpha = 1.0, shape = 24) +
facet_grid(inv~chr) +
theme_bw() +
geom_hline(yintercept=1) +
xlab("Model") +
theme(axis.text.x=element_blank()) +
scale_y_continuous(trans = "log2")
#aic.en.plot <-
ggplot() +
geom_linerange(data = o2.ag.ranked[!is.na(sig)][order(!sig)],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
),color = "grey", alpha = 0.5,
#position=position_dodge2(width=.5)
) +
geom_linerange(data=
o2.ag.ranked[sig == TRUE][order(!sig)],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
#color = sig
),alpha = 0.7, size = 0.8, color = "blue"
#position=position_dodge2(width=.5)
) +
geom_point(data = o2.ag.ranked[!is.na(sig)][order(!sig)],
aes(x=modRank.in2lt, y=(rr), #shape=inv
), color = "grey",
#position=position_dodge2(width=.5),
size=2, alpha = 0.6) +
geom_point(data = o2.ag.ranked[sig == TRUE][order(!sig)],
aes(x=modRank.in2lt, y=(rr), #shape=inv
), color = "blue",
#position=position_dodge2(width=.5),
size=2, alpha = 0.6) +
geom_linerange(data=
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "temp.max"][mod == 2],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
color = sig
),alpha = 0.7, size = 1.5
#position=position_dodge2(width=.5)
) +
geom_point(data =
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "temp.max"][mod == 2],
aes(x=modRank.in2lt, y=(rr), #shape=inv
fill = sig),
#position=position_dodge2(width=.5),
size=3, alpha = 1.0, shape = 21) +
geom_linerange(data=
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "null"],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
color = sig
),alpha = 0.7, size = 1.5
#position=position_dodge2(width=.5)
) +
geom_point(data =
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "null"],
aes(x=modRank.in2lt, y=(rr), #shape=inv
fill = sig),
#position=position_dodge2(width=.5),
size=3, alpha = 1.0, shape = 22) +
geom_linerange(data=
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "pop_year"],
aes(x=modRank.in2lt,
ymin=(prop.real/prop.perm.uci),
ymax=(prop.real/prop.perm.lci),
color = sig
),alpha = 1.0, size = 1.5
#position=position_dodge2(width=.5)
) +
geom_point(data =
o2.ag.ranked[!is.na(sig)][order(!sig)][var == "pop_year"],
aes(x=modRank.in2lt, y=(rr), #shape=inv
fill = sig),
#position=position_dodge2(width=.5),
size=3, alpha = 1.0, shape = 24) +
facet_grid(inv~chr) +
theme_bw() +
geom_hline(yintercept=1) +
xlab("Model") +
theme(axis.text.x=element_blank()) +
scale_y_continuous(trans = "log2")
fl <- list.files("/project/berglandlab/alan/environmental_ombibus_global",full.names=T)
fl
fl= fl[1]
model = fl.mod[1][6]
fl = fl[1]
o2.ag %>%
filter(!is.na(sig)) %>%
filter(sig == TRUE) %>%
group_by(chr, inv, cluster) %>%
arrange(-rr) %>%
slice_head(n=2) %>% as.data.frame()
setwd("/Users/jcbnunez/Documents/GitHub/Cville-Seasonality-2016-2019/REPRODUCE_FIg3_S7_S10")
rm(list = ls())
library(data.table)
library(tidyverse)
library(magrittr)
library(foreach)
library(doMC)
registerDoMC(4)
library(tidyr)
library(patchwork)
####
####  create window objects
final.windows.pos =
data.frame(win.name = c("left", "win_3.1", "win_4.7", "win_5.1", "win_6.1", "win_6.8", "win_9.6", "right" ),
mid = c(2.2, 3.0, 4.67, 5.12, 6.2, 6.8 , 9.6, 13.1),
chr = "2L"
) %>%
mutate(start = (mid-0.2)*1e6 ,
end  = (mid+0.2)*1e6  )
### load thermal GLM object
sets <- data.table(mod=c(1:11),
start=c(0,  0,  0,  7, 15, 30, 60, 15, 45,  0,  0),
end=	 c(7, 15, 30, 15, 30, 60, 90, 45, 75, 60, 90))
####### PLot
load("./window.enrich.set.Rdata")
load("./machado.datasets.enrch.Rdata")
rbind(mutate(machado.datasets.enrch, set.type = "Machado"  ),
mutate(enrichment.sets, set.type = "DEST")) %>%
#filter(analysis_type == "best_model") %>%
#separate(anchor.model, into = c("model", "resolution.mod", "demo.region"), sep = ";" ) %>%
mutate(start=win.start,
end=win.end
) %>%      left_join(final.windows.pos) %>%
ggplot(aes(
x=win.name,
y=log2(or),
ymin=log2(lci),
ymax=log2(uci),
color = anchor.model,
fill = anchor.model,
)) +
geom_hline(yintercept = 0, linetype = "dashed") +
geom_errorbar(size = 0.5, width = 0.25, position=position_dodge(width=0.5)) +
geom_point(size = 2.0, shape = 21, position=position_dodge(width=0.5), color = "black") +
theme_bw() +
facet_grid(set.type~., scales = "free_y") +
theme(legend.pos = "none") ->
enrich.plot
#ggsave(enrich.plot, file = "enrich.plot.pdf", w = 5, h = 4)
rbind(mutate(machado.datasets.enrch, set.type = "Machado"  ),
mutate(enrichment.sets, set.type = "DEST")) %>%
#filter(analysis_type == "best_model") %>%
#separate(anchor.model, into = c("model", "resolution.mod", "demo.region"), sep = ";" ) %>%
mutate(start=win.start,
end=win.end
) %>%
left_join(final.windows.pos) %>%
ggplot(aes(
x=win.name,
y=(st.pr),
ymin=(st.lci),
ymax=(st.uci),
color = anchor.model,
fill = anchor.model,
)) +
geom_errorbar(size = 0.5, width = 0.25, position=position_dodge(width=0.5)) +
geom_point(size = 2.0, shape = 21, position=position_dodge(width=0.5), color = "black") +
theme_bw() +
facet_grid(set.type~., scales = "free_y") +
theme(legend.pos = "bottom") ->
dir.plot
dir.plot
enrich.plot
setwd("/Users/jcbnunez/Documents/GitHub/Cville-Seasonality-2016-2019/REPRODUCE_Fig5_S11/")
library(tidyverse)
library(magrittr)
library(data.table)
library(car)
library(DescTools)
library(foreach)
library(doMC)
library(patchwork)
library(ggbeeswarm)
haplo.time.colortemp.ave
load("DatFor.Haplotypes.trajectory.time.weather.Rdata")
Cville_haplotags_for_viz %>%
ggplot(aes(
x=yday,
y=Mean_haplotag,
#ymin=ci_l,
#ymax=ci_h,
color=(temp.max),
)) +
#geom_smooth(method = "lm", se = F, size = 0.8, color = "grey") +
#geom_errorbar(width = 0.1) +
scale_color_gradient2(low="steelblue", high = "firebrick2", mid = "gold1",
midpoint = 25) +
geom_point(aes(shape=as.factor(year))) +
geom_smooth( se = F, size = 0.8, color = "black", linetype = "dashed") +
ylim(0,0.38) +
theme_bw() +
facet_grid(win~.)->
haplo.time.colortemp.ave
colortemp
haplo.time.colortemp.ave
Cville_haplotags_for_viz %>%
ggplot(aes(
x=yday,
y=Mean_haplotag,
#ymin=ci_l,
#ymax=ci_h,
color=(temp.max),
)) +
#geom_smooth(method = "lm", se = F, size = 0.8, color = "grey") +
#geom_errorbar(width = 0.1) +
scale_color_gradient2(low="steelblue", high = "firebrick2", mid = "gold1",
midpoint = 25) +
geom_point(aes(shape=as.factor(year))) +
geom_smooth( se = F, size = 0.8, color = "black", linetype = "dashed") +
ylim(0,0.38) +
theme_bw() +
facet_grid(.~win)->
haplo.time.colortemp.ave
haplo.time.colortemp.ave
View(weather.ave)
full_join(weather.ave, clusts) -> weather.ave.clust
cor.test
best.nominal.models.compared$cor.mods[i] = cor.test(x=dat1$X, y=dat2$X)$estimate
tmp <- get(load(paste("/scratch/yey2sn/Overwintering_ms/4.2.env.omibus.mods/out.aic.folder",
files.loc[i], sep = "/")))
