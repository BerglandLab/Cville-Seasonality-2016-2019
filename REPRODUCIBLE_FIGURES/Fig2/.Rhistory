y=PI
)) +
geom_line() +
geom_vline(xintercept = 7702805) +
geom_vline(xintercept = 7710690)
pi.inv %>%
filter(CHROM == "2L") %>%
ggplot(aes(
x=(BIN_START+BIN_END)/2,
y=PI
)) +
geom_line() +
geom_vline(xintercept = 7702805) +
geom_vline(xintercept = 7710690)
pi.inv <- read.delim("~/Downloads/D.CM.W_100000.S_50000.INV.Tajima.D")
pi.inv
pi.inv %>%
filter(CHROM == "2L") %>%
ggplot(aes(
x=(BIN_START+BIN_END)/2,
y=TajimaD
)) +
geom_line() +
geom_vline(xintercept = 7702805) +
geom_vline(xintercept = 7710690)
pi.inv %>%
filter(CHROM == "2L") %>%
ggplot(aes(
x=(BIN_START,
pi.inv %>%
filter(CHROM == "2L") %>%
ggplot(aes(
x=BIN_START,
y=TajimaD
)) +
geom_line() +
geom_vline(xintercept = 7702805) +
geom_vline(xintercept = 7710690)
D.inv <- read.delim("~/Downloads/D.CM.W_100000.S_50000.INV.Tajima.D")
D.inv %>%
filter(CHROM == "2L") %>%
ggplot(aes(
x=BIN_START,
y=TajimaD
)) +
geom_vline(xintercept = 7702805, color = "red") +
geom_line(size = 1.2) +
q
D.inv %>%
filter(CHROM == "2L") %>%
ggplot(aes(
x=BIN_START,
y=TajimaD)) +
geom_vline(xintercept = 7702805, color = "red") +
geom_line(size = 1.2)
D.inv %>%
filter(CHROM == "2L") %>%
ggplot(aes(
x=BIN_START,
y=TajimaD)) +
geom_vline(xintercept = 7702805, color = "red") +
geom_hline(yintercept = 0) +
geom_hline(yintercept = 1, lintype = "dashed") +
geom_hline(yintercept = -1, lintype = "dashed") +
geom_line(size = 1.2)
D.inv %>%
filter(CHROM == "2L") %>%
ggplot(aes(
x=BIN_START,
y=TajimaD)) +
geom_vline(xintercept = 7702805, color = "red") +
geom_hline(yintercept = 0) +
geom_hline(yintercept = 1, linetype = "dashed") +
geom_hline(yintercept = -1, linetype = "dashed") +
theme_bw() +
geom_line(size = 1.2)
D.std <- read.delim("~/Downloads/D.CM.W_100000.S_50000.STD.Tajima.D")
D.std %>%
filter(CHROM == "2L") %>%
ggplot(aes(
x=BIN_START,
y=TajimaD)) +
geom_vline(xintercept = 7702805, color = "red") +
geom_hline(yintercept = 0) +
geom_hline(yintercept = 1, linetype = "dashed") +
geom_hline(yintercept = -1, linetype = "dashed") +
theme_bw() +
geom_line(size = 1.2)
D.std %>%
filter(CHROM == "2L") %>%
ggplot(aes(
x=BIN_START,
y=TajimaD)) +
geom_vline(xintercept = 7702805, color = "red") +
geom_hline(yintercept = 0) +
geom_hline(yintercept = 1, linetype = "dashed") +
geom_hline(yintercept = -1, linetype = "dashed") +
theme_bw() +
geom_line(size = 1.2, color = "grey")
D.inv
D.inv <- read.delim("~/Downloads/D.CM.W_100000.S_50000.INV.Tajima.D")
D.std <- read.delim("~/Downloads/D.CM.W_100000.S_50000.STD.Tajima.D")
library(tidyverse)
library(magrittr)
D.inv <- read.delim("~/Downloads/D.CM.W_100000.S_50000.INV.Tajima.D")
D.inv %<>% mutate(set = "inv")
D.std <- read.delim("~/Downloads/D.CM.W_100000.S_50000.STD.Tajima.D")
D.std %<>% mutate(set = "std")
rbind(D.inv, D.std) %>%
filter(CHROM == "2L") %>%
ggplot(aes(
x=BIN_START,
y=TajimaD,
color = set)) +
geom_vline(xintercept = 7702805, color = "red") +
geom_hline(yintercept = 0) +
geom_hline(yintercept = 1, linetype = "dashed") +
geom_hline(yintercept = -1, linetype = "dashed") +
theme_bw() +
geom_line(size = 1.1)
rbind(D.inv, D.std) %>%
filter(CHROM == "2L") %>%
ggplot(aes(
x=BIN_START,
y=TajimaD,
color = set)) +
geom_vline(xintercept = 7702805, color = "purple") +
geom_hline(yintercept = 0) +
geom_hline(yintercept = 1, linetype = "dashed") +
geom_hline(yintercept = -1, linetype = "dashed") +
theme_bw() +
geom_line(size = 1.1)
rbind(D.inv, D.std) %>%
filter(CHROM == "2L") %>%
ggplot(aes(
x=BIN_START,
y=TajimaD,
color = set)) +
geom_vline(xintercept = 7702805, color = "purple") +
geom_vline(xintercept = 2225744) +
geom_vline(xintercept = 13154180) +
geom_hline(yintercept = 0) +
geom_hline(yintercept = 1, linetype = "dashed") +
geom_hline(yintercept = -1, linetype = "dashed") +
theme_bw() +
geom_line(size = 1.1)
rbind(D.inv, D.std) %>%
filter(CHROM == "#L") %>%
ggplot(aes(
x=BIN_START,
y=TajimaD,
color = set)) +
geom_vline(xintercept = 3336032, color = "purple") +
geom_hline(yintercept = 0) +
geom_hline(yintercept = 1, linetype = "dashed") +
geom_hline(yintercept = -1, linetype = "dashed") +
theme_bw() +
geom_line(size = 1.1)
rbind(D.inv, D.std) %>%
filter(CHROM == "3L") %>%
ggplot(aes(
x=BIN_START,
y=TajimaD,
color = set)) +
geom_vline(xintercept = 3336032, color = "purple") +
geom_hline(yintercept = 0) +
geom_hline(yintercept = 1, linetype = "dashed") +
geom_hline(yintercept = -1, linetype = "dashed") +
theme_bw() +
geom_line(size = 1.1)
rbind(D.inv, D.std) %>%
filter(CHROM == "2L") %>%
ggplot(aes(
x=BIN_START,
y=TajimaD,
color = set)) +
geom_vline(xintercept = 7702805, color = "purple") +
geom_vline(xintercept = 2225744) +
geom_vline(xintercept = 13154180) +
geom_hline(yintercept = 0) +
geom_hline(yintercept = 1, linetype = "dashed") +
geom_hline(yintercept = -1, linetype = "dashed") +
theme_bw() +
xlim(7e6,8e6) +
geom_line(size = 1.1)
library(tidyverse)
library(magrittr)
library(data.table)
library(foreach)
root <- paste(base, paste("data3", metric, sep = "."), sep = "/")
root <- paste(base, paste("data3", metric, sep = "."), sep = "/")
library(data.table)
library(tidyverse)
library(magrittr)
library(reshape2)
library(foreach)
## load
choice.dat <- fread("/Users/jcbnunez/Downloads/Final_Project_Fly_Count.tsv")
library(tidyverse)
a = c( rep(6970, 13), rep(317, 2) )
1/mean(1/a)
a = c( rep(25000, 13), rep(2500, 2) )
1/mean(1/a)
a = c( rep(25000, 13), rep(1500, 2) )
1/mean(1/a)
rm(list = ls())
library(tidyverse)
library(magrittr)
library(factoextra)
library(FactoMineR)
library(gtools)
library(patchwork)
library(ggalt)
slice_n
?slice_n
?slice_
slice_
library(vcfR)
library(adegenet)
library(tidyverse)
library(vroom)
slice_mutation_of_interst.stus %>%
filter(loci %in% c(0,2)) %>%
group_by(loci) %>%
slice_head(n=9)
glm.snps$SNP_id[i]
setwd("/Users/jcbnunez/Documents/GitHub/Cville-Seasonality-2016-2019/REPRODUCE_FIg1_S1")
load("Fig1.panels.AB.dat.Rdata")
label.df_PCA <- PCA_table %>%
group_by(city) %>%
summarize(Dim.1 = mean(Dim.1),
Dim.2 = mean(Dim.2),
Dim.3 = mean(Dim.3))
library(tidyverse)
library(magrittr)
library(factoextra)
library(FactoMineR)
library(gtools)
library(patchwork)
library(ggalt)
load("Fig1.panels.AB.dat.Rdata")
label.df_PCA <- PCA_table %>%
group_by(city) %>%
summarize(Dim.1 = mean(Dim.1),
Dim.2 = mean(Dim.2),
Dim.3 = mean(Dim.3))
label.df_PCA.time <- PCA_table %>%
group_by(city, year) %>%
summarize(Dim.1 = mean(Dim.1),
Dim.2 = mean(Dim.2),
Dim.3 = mean(Dim.3),
Dim.4 = mean(Dim.4))
PCA_table$city %>% unique -> cities_to_select
corr_list = list()
for(i in 1:length(cities_to_select)){
print(i)
time <- PCA_table$year[which(PCA_table$city == cities_to_select[i])]
pc_proj1 <- PCA_table$Dim.1[which(PCA_table$city == cities_to_select[i])]
tmp1 = cor.test(pc_proj1, time)
tmp_df1 = data.frame(p_val = tmp1$p.value,
cor = tmp1$estimate,
uci = tmp1$conf.int[2],
lci = tmp1$conf.int[1],
PC = 1,
city = cities_to_select[i],
sig_sym = ifelse(tmp1$p.value < 0.05, "S", "NS") )
pc_proj2 <- PCA_table$Dim.2[which(PCA_table$city == cities_to_select[i])]
tmp2 = cor.test(pc_proj2, time)
tmp_df2 = data.frame(p_val = tmp2$p.value,
cor = tmp2$estimate,
uci = tmp1$conf.int[2],
lci = tmp1$conf.int[1],
PC = 2,
city = cities_to_select[i],
sig_sym = ifelse(tmp2$p.value < 0.05, "S", "NS") )
pc_proj3 <- PCA_table$Dim.3[which(PCA_table$city == cities_to_select[i])]
tmp3 = cor.test(pc_proj3, time)
tmp_df3 = data.frame(p_val = tmp3$p.value,
cor = tmp3$estimate,
uci = tmp1$conf.int[2],
lci = tmp1$conf.int[1],
PC = 3,
city = cities_to_select[i],
sig_sym = ifelse(tmp3$p.value < 0.05, "S", "NS") )
corr_list[[i]] = rbind(tmp_df1, tmp_df2, tmp_df3)
}
corr_list_df = do.call(rbind, corr_list)
corr_list_df %<>%
mutate(R2 = cor^2)
corr_list_df %>%
group_by(PC, sig_sym) %>%
summarise(N = n())
corr_list_df
corr_list_df %>%
group_by(PC) %>%
summarise(mean.all = ci(R2)[1],
lci = ci(R2)[2],
uci = ci(R2)[3]
)
library(gmodels)
corr_list_df %>%
group_by(PC, sig_sym) %>%
summarise(N = n())
label.df_PCA.time <- PCA_table %>%
group_by(city, year) %>%
summarize(Dim.1 = mean(Dim.1),
Dim.2 = mean(Dim.2),
Dim.3 = mean(Dim.3),
Dim.4 = mean(Dim.4))
PCA_table$city %>% unique -> cities_to_select
corr_list = list()
for(i in 1:length(cities_to_select)){
print(i)
time <- PCA_table$year[which(PCA_table$city == cities_to_select[i])]
pc_proj1 <- PCA_table$Dim.1[which(PCA_table$city == cities_to_select[i])]
tmp1 = cor.test(pc_proj1, time)
tmp_df1 = data.frame(p_val = tmp1$p.value,
cor = tmp1$estimate,
uci = tmp1$conf.int[2],
lci = tmp1$conf.int[1],
PC = 1,
city = cities_to_select[i],
sig_sym = ifelse(tmp1$p.value < 0.05, "S", "NS") )
pc_proj2 <- PCA_table$Dim.2[which(PCA_table$city == cities_to_select[i])]
tmp2 = cor.test(pc_proj2, time)
tmp_df2 = data.frame(p_val = tmp2$p.value,
cor = tmp2$estimate,
uci = tmp1$conf.int[2],
lci = tmp1$conf.int[1],
PC = 2,
city = cities_to_select[i],
sig_sym = ifelse(tmp2$p.value < 0.05, "S", "NS") )
pc_proj3 <- PCA_table$Dim.3[which(PCA_table$city == cities_to_select[i])]
tmp3 = cor.test(pc_proj3, time)
tmp_df3 = data.frame(p_val = tmp3$p.value,
cor = tmp3$estimate,
uci = tmp1$conf.int[2],
lci = tmp1$conf.int[1],
PC = 3,
city = cities_to_select[i],
sig_sym = ifelse(tmp3$p.value < 0.05, "S", "NS") )
corr_list[[i]] = rbind(tmp_df1, tmp_df2, tmp_df3)
}
corr_list_df = do.call(rbind, corr_list)
corr_list_df %<>%
mutate(R2 = cor^2)
corr_list_df %>%
group_by(PC, sig_sym) %>%
summarise(N = n())
corr_list_df
corr_list_df %>%
group_by(PC) %>%
summarise(mean.all = ci(R2)[1],
lci = ci(R2)[2],
uci = ci(R2)[3]
)
label.df_PCA.time %>%
group_by(city) %>%
filter(year == min(year) | year == max(year)) %>%
mutate(mean_y = mean(year)) %>%
mutate(endpt = ifelse(year > mean_y, "max", "min")) %>%
melt(id=c("city","year","mean_y", "endpt")) %>%
reshape2::dcast(city ~ variable+endpt ) %>%
left_join(corr_list_df) ->
label.df_PCA.time.min.max
library(tidyverse)
library(magrittr)
library(factoextra)
library(FactoMineR)
library(gtools)
library(patchwork)
library(ggalt)
label.df_PCA.time %>%
group_by(city) %>%
filter(year == min(year) | year == max(year)) %>%
mutate(mean_y = mean(year)) %>%
mutate(endpt = ifelse(year > mean_y, "max", "min")) %>%
melt(id=c("city","year","mean_y", "endpt")) %>%
reshape2::dcast(city ~ variable+endpt ) %>%
left_join(corr_list_df) ->
label.df_PCA.time.min.max
melt
label.df_PCA.time
label.df_PCA.time %>%
group_by(city) %>%
filter(year == min(year) | year == max(year))
label.df_PCA.time %>%
group_by(city) %>%
filter(year == min(year) | year == max(year)) %>%
mutate(mean_y = mean(year)) %>%
mutate(endpt = ifelse(year > mean_y, "max", "min")) %>%
melt(id=c("city","year","mean_y", "endpt")) %>%
reshape2::dcast(city ~ variable+endpt )
melt
reshape2::melt
label.df_PCA.time %>%
group_by(city) %>%
filter(year == min(year) | year == max(year)) %>%
mutate(mean_y = mean(year)) %>%
mutate(endpt = ifelse(year > mean_y, "max", "min")) %>%
reshape2::melt(id=c("city","year","mean_y", "endpt")) %>%
reshape2::dcast(city ~ variable+endpt ) %>%
left_join(corr_list_df) ->
label.df_PCA.time.min.max
label.df_PCA.time.min.max
lm(Dim.1 ~ lat + long, weights = MeanEC, data =  PCA_table) -> dim1.lat.long
anova(dim1.lat.long)
lm(Dim.2 ~ lat + long, weights = MeanEC, data =  filter(PCA_table, continent == "Europe")) -> dim2.lat.long
anova(dim2.lat.long)
setwd("../REPRODUCE_FIg2_S4/")
#load packages
library(tidyverse)
library(magrittr)
library(factoextra)
library(FactoMineR)
library(gtools)
library(patchwork)
library(ggalt)
anova(lm(Dim.1 ~ year, data = filter(pca_table_df, chr == "2L" )))
load("make.Fig2.panelA.Rdata")
ggplot() +
geom_point(shape =21,
size = 3,
alpha = 0.9,
data = pca_table_df,
aes(
x=Dim.1,
y=Dim.2,
fill = year)
) +
scale_fill_gradient2(low = "blue", high = "red",
mid = "gold",
midpoint = 2016) +
theme_bw() +
ylab("PC2") +
xlab("PC1") +
facet_wrap(~chr) ->
cville_chr_pca
ggsave(cville_chr_pca,
file = "cville_chr_pca.pdf",
width = 5,
height = 4)
### Quantify
anova(lm(Dim.1 ~ year, data = filter(pca_table_df, chr == "2L" )))
anova(lm(Dim.1 ~ year, data = filter(pca_table_df, chr == "2R" )))
anova(lm(Dim.1 ~ year, data = filter(pca_table_df, chr == "3L" )))
anova(lm(Dim.1 ~ year, data = filter(pca_table_df, chr == "3R" )))
setwd("../REPRODUCE_FIg1_S1//")
library(tidyverse)
library(magrittr)
library(forcats)
library(FactoMineR)
library(gtools)
library(poolfstat)
library(gdsfmt)
library(SNPRelate)
library(SeqArray)
library(data.table)
library(gmodels)
library(MASS)
### panel DC
load("Fig1.panelC.Rdata")
Out_comp_vector_samepops %>%
.[which(.$bin_date %in%
c("2.Overwinter", "1.within") ),] %>%
group_by(pop1, bin_date) %>%
summarise(FST_mean = mean(FST)) %>%
dcast(pop1 ~ bin_date) ->
mean_fst
Out_comp_vector_samepops %>%
group_by(bin_date) %>%
summarise(med = quantile(FST, 0.5 ))
anova(lm(FST ~ bin_date, data = filter(Out_comp_vector_samepops, bin_date %in% c("1.within", "2.Overwinter") )))
anova(lm(FST ~ bin_date, data = filter(Out_comp_vector_samepops, bin_date %in% c("1.within", "2.Overwinter") )))
anova(lm(FST ~ year_diff*pop1, data = multiyear_samps ))
### panel D
load("Fig1.panelD.Rdata")
anova(lm(FST ~ year_diff*pop1, data = multiyear_samps ))
setwd("../REPRODUCE_FIg2_S4/")
#load packages
library(tidyverse)
library(magrittr)
library(factoextra)
library(FactoMineR)
library(gtools)
library(patchwork)
library(ggalt)
load("make.Fig2.panelA.Rdata")
ggplot() +
geom_point(shape =21,
size = 3,
alpha = 0.9,
data = pca_table_df,
aes(
x=Dim.1,
y=Dim.2,
fill = year)
) +
scale_fill_gradient2(low = "blue", high = "red",
mid = "gold",
midpoint = 2016) +
theme_bw() +
ylab("PC2") +
xlab("PC1") +
facet_wrap(~chr) ->
cville_chr_pca
cville_chr_pca
anova(lm(Dim.1 ~ year, data = filter(pca_table_df, chr == "2L" )))
anova(lm(Dim.1 ~ year, data = filter(pca_table_df, chr == "2R" )))
anova(lm(Dim.1 ~ year, data = filter(pca_table_df, chr == "3L" )))
anova(lm(Dim.1 ~ year, data = filter(pca_table_df, chr == "3R" )))
anova(lm(Dim.1 ~ year, data = filter(pca_table_df, chr == "2L" )))
