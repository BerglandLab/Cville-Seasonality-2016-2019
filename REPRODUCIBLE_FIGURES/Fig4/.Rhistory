debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
q
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
debugSource("~/Documents/GitHub/DESTv2_data_paper/11.Seasonality_Analysis/1.Seasonality_Analysis.R")
52676.84+45118.95
52676.84+45118.95
97795.79+48000
145795.8-122000
97047+50945+45118+52676+8400+14656
375-=250
375-250
70/9
7700*3
7700*2
15400*2
84000/9
9333*2
18666*2
55*2
56,484 + 56,880
56484 + 56880
9333*3
53900*2
32.5*55000
0.325*55000
17875*2
0.74 * 15000
0.074 * 15000
1110*2*1
1110*2*1
0.74 * 15000
0.074 * 30000
2220*2
5000 * 0.08
400*6
47000*0.47
22090+35750+4440+2400
5+3+3
11*6000
6000+3285+66000
3000+1200
75285+4200+12000
7*6
7*6000
11 * 6000
27999*0.47
30800*0.47
13159.53+14476
7966/4
4*50000
(4*50000)*(2.0e-9)
(4*50000)*(2.9e-9)
(4*50000)
### open metadata
samps <- get(load("/project/berglandlab/DEST2.0_working_data/joint.metadata.Rdata"))
pc.objc$eig[1:40,] %>%
as.data.frame() %>%
mutate(adj.perc = `percentage of variance`/40) %>%
mutate(selected_snps = round(adj.perc*40000,0)) ->
object.to.select.gims
fil.root = paste(root, fil, sep = "/")
dat.flt %>% filter(perm == perm.th, .combine = "rbind" ) -> tmp0
obs.data
library(data.table)
library(tidyverse)
library(magrittr)
library(foreach)
#### first download the current sample metadata form
samps <- fread("/Users/jcbnunez/Documents/GitHub/DESTv2/populationInfo/dest_v2.samps_25Feb2023.csv")
samps.old.dat = filter(samps, !is.na(sampleId_orig)
& set != "dgn"
)
file.targ = c(
"/Users/jcbnunez/Documents/GitHub/DEST-bio.github.io/assets/util/MD5/MD5_bed.gz.ALL.txt.csv",
"/Users/jcbnunez/Documents/GitHub/DEST-bio.github.io/assets/util/MD5/MD5_masked.sync.gz.ALL.txt.csv",
"/Users/jcbnunez/Documents/GitHub/DEST-bio.github.io/assets/util/MD5/MD5_SNAPE.monomorphic.masked.sync.gz.ALL.txt.csv "
)
foreach(input.txt = file.targ)%do%{ #### open i
foreach(i = 1:dim(samps.old.dat)[1])%do%{ #### open i
old.text=samps.old.dat$sampleId_orig[i]
new.text=samps.old.dat$sampleId[i]
set=samps.old.dat$set[i]
#input.txt=file.targ
message(paste("changing",old.text, "to",new.text, "set=",  set))
if(set != "dgn"){ ### set
system(
paste( "sed -i ''",
paste("'s/", old.text, "/", new.text, "/g'", sep = "") ,
input.txt,
sep = " ")
)
#system(
#  paste( "sed -i ''",
#         paste("'s|",
#               paste("/",old.text,"/",old.text, ".", sep = "") ,
#               "|",
#               paste("/",new.text,"/",new.text, ".",sep = "") ,
#               "|g'", sep = ""),
#         input.txt,
#         sep = " ")
#)
} ### set
#if(set == "dgn"){ ### set
#
#  system(
#    paste( "sed -i ''",
#           paste("'s/| ", old.text, "./| ", new.text, "./g'", sep = "") ,
#           input.txt,
#           sep = " ")
#  )
#
#  system(
#    paste( "sed -i ''",
#           paste("'s|",
#                 paste("DGN/",old.text,"/",old.text, ".", sep = "") ,
#                 "|",
#                 paste("DGN/",new.text,"/",new.text, ".",sep = "") ,
#                 "|g'", sep = ""),
#           input.txt,
#           sep = " ")
#  )
#
#} ### set
} #### close i
} #### close file targ
samps.old.dat.dgn = filter(samps, !is.na(sampleId_orig)
& set == "dgn"
)
foreach(input.txt = file.targ.dgn)%do%{ #### open i
foreach(i = 1:dim(samps.old.dat.dgn)[1])%do%{ #### open i
old.text=samps.old.dat.dgn$sampleId_orig[i]
new.text=samps.old.dat.dgn$sampleId[i]
set=samps.old.dat.dgn$set[i]
#input.txt=file.targ
message(paste("changing",old.text, "to",new.text, "set=",  set))
#if(set != "dgn"){ ### set
#
#  system(
#    paste( "sed -i ''",
#           paste("'s/", old.text, "/", new.text, "/g'", sep = "") ,
#           input.txt,
#           sep = " ")
#  )
#
#  #system(
#  paste( "sed -i ''",
#         paste("'s|",
#               paste("/",old.text,"/",old.text, ".", sep = "") ,
#               "|",
#               paste("/",new.text,"/",new.text, ".",sep = "") ,
#               "|g'", sep = ""),
#         input.txt,
#         sep = " ")
#)
# } ### set
if(set == "dgn"){ ### set
system(
paste( "sed -i ''",
paste("'s/| ", old.text, "./| ", new.text, "./g'", sep = "") ,
input.txt,
sep = " ")
)
system(
paste( "sed -i ''",
paste("'s|",
paste("DGN/",old.text,"/",old.text, ".", sep = "") ,
"|",
paste("DGN/",new.text,"/",new.text, ".",sep = "") ,
"|g'", sep = ""),
input.txt,
sep = " ")
)
} ### set
} #### close i
} #### close file targ
samps.old.dat.dgn
samps.old.dat.dgn = filter(samps, !is.na(sampleId_orig)
& set == "dgn"
)
samps.old.dat.dgn
file.targ.dgn = c("/Users/jcbnunez/Documents/GitHub/DEST-bio.github.io/assets/util/MD5/MD5_masked.sync.gz.justDGN.csv")
samps.old.dat.dgn = filter(samps, !is.na(sampleId_orig)
& set == "dgn"
)
foreach(input.txt = file.targ.dgn)%do%{ #### open i
foreach(i = 1:dim(samps.old.dat.dgn)[1])%do%{ #### open i
old.text=samps.old.dat.dgn$sampleId_orig[i]
new.text=samps.old.dat.dgn$sampleId[i]
set=samps.old.dat.dgn$set[i]
#input.txt=file.targ
message(paste("changing",old.text, "to",new.text, "set=",  set))
#if(set != "dgn"){ ### set
#
#  system(
#    paste( "sed -i ''",
#           paste("'s/", old.text, "/", new.text, "/g'", sep = "") ,
#           input.txt,
#           sep = " ")
#  )
#
#  #system(
#  paste( "sed -i ''",
#         paste("'s|",
#               paste("/",old.text,"/",old.text, ".", sep = "") ,
#               "|",
#               paste("/",new.text,"/",new.text, ".",sep = "") ,
#               "|g'", sep = ""),
#         input.txt,
#         sep = " ")
#)
# } ### set
if(set == "dgn"){ ### set
system(
paste( "sed -i ''",
paste("'s/| ", old.text, "./| ", new.text, "./g'", sep = "") ,
input.txt,
sep = " ")
)
system(
paste( "sed -i ''",
paste("'s|",
paste("DGN/",old.text,"/",old.text, ".", sep = "") ,
"|",
paste("DGN/",new.text,"/",new.text, ".",sep = "") ,
"|g'", sep = ""),
input.txt,
sep = " ")
)
} ### set
} #### close i
} #### close file targ
file.targ.dgn = c("/Users/jcbnunez/Documents/GitHub/DEST-bio.github.io/assets/util/MD5/MD5_masked.sync.gz.justDGN.csv")
file.targ.dgn
samps.old.dat.dgn
file.targ.dgn
samps.old.dat.dgn
old.text=samps.old.dat.dgn$sampleId_orig[i]
new.text=samps.old.dat.dgn$sampleId[i]
set=samps.old.dat.dgn$set[i]
#input.txt=file.targ
message(paste("changing",old.text, "to",new.text, "set=",  set))
paste( "sed -i ''",
paste("'s/| ", old.text, "./| ", new.text, "./g'", sep = "") ,
input.txt,
sep = " ")
system(
paste( "sed -i ''",
paste("'s/| ", old.text, "./| ", new.text, "./g'", sep = "") ,
input.txt,
sep = " ")
)
paste( "sed -i ''",
paste("'s|",
paste("DGN/",old.text,"/",old.text, ".", sep = "") ,
"|",
paste("DGN/",new.text,"/",new.text, ".",sep = "") ,
"|g'", sep = ""),
input.txt,
sep = " ")
foreach(input.txt = file.targ.dgn)%do%{ #### open i
foreach(i = 1:dim(samps.old.dat.dgn)[1])%do%{ #### open i
old.text=samps.old.dat.dgn$sampleId_orig[i]
new.text=samps.old.dat.dgn$sampleId[i]
set=samps.old.dat.dgn$set[i]
#input.txt=file.targ
message(paste("changing",old.text, "to",new.text, "set=",  set))
#if(set != "dgn"){ ### set
#
#  system(
#    paste( "sed -i ''",
#           paste("'s/", old.text, "/", new.text, "/g'", sep = "") ,
#           input.txt,
#           sep = " ")
#  )
#
#  #system(
#  paste( "sed -i ''",
#         paste("'s|",
#               paste("/",old.text,"/",old.text, ".", sep = "") ,
#               "|",
#               paste("/",new.text,"/",new.text, ".",sep = "") ,
#               "|g'", sep = ""),
#         input.txt,
#         sep = " ")
#)
# } ### set
#if(set == "dgn"){ ### set
system(
paste( "sed -i ''",
paste("'s/| ", old.text, "./| ", new.text, "./g'", sep = "") ,
input.txt,
sep = " ")
)
system(
paste( "sed -i ''",
paste("'s|",
paste("DGN/",old.text,"/",old.text, ".", sep = "") ,
"|",
paste("DGN/",new.text,"/",new.text, ".",sep = "") ,
"|g'", sep = ""),
input.txt,
sep = " ")
)
#} ### set
} #### close i
} #### close file targ
ac <- get(load(/Users/jcbnunez/Downloads/GLM.season_pop_by_year_All.SNPrange.16033.16533.Rdata
ac <- get(load("/Users/jcbnunez/Downloads/GLM.season_pop_by_year_All.SNPrange.16033.16533.Rdata
"))
ac <- get(load("/Users/jcbnunez/Downloads/GLM.season_pop_by_year_All.SNPrange.16033.16533.Rdata"))
ac
anchored.samp[complete.cases(anchored.samp),] %>% rownames() ->
GIMS.id.noNas
?dapc
samps.used.in.modeltrain$province
1361.40-1400
6641.07/12
1700/12
554+142
1479.00/12
554+124
700/12
qc.dat <- get(load("Miss.Cov.PCRdup.sim.joint.Rdata"))
load("/Users/jcbnunez/Downloads/final.calls.QC.Rdata")
ls()
final.calls
final.calls %>% tail
final.calls %>% tail(40)
final.calls %>% head(40)
10^1
10^-1
10^-2
?write.table
samp.i="aaa"
data.frame(samp.i, "Complete")
data.frame(s=samp.i, i="Complete")
fns <- system("ls /scratch/yey2sn/DEST2_analysis/filtering/sim_contam_final/*.Rdata", intern=T)
load("/Users/jcbnunez/Downloads/GLM_out.1.2L_5762_17762.Rdata")
o
780/4
13173.00*0.25
687778848/2
ld_df_winanot_pair.flt.glm %>%
mutate(p_lrt.tresh = case_when(
p_lrt < 0.1 & p_lrt >= 0.01  ~ "p-1",
p_lrt < 0.01 & p_lrt >= 0.001 ~ "p-2",
p_lrt < 0.001 & p_lrt >= 0.0001 ~ "p-3",
p_lrt < 0.0001 & p_lrt >= 1e-5 ~ "p-4",
p_lrt < 1e-5 ~ "p-5",
)) %>%
ggplot(aes(
x=winComp,
y=R2,
fill=p_lrt.tresh
)) +
geom_boxplot(outlier.shape = NA) +
facet_wrap(st) ->
rnp.tresh.plot
17000/0.5
17000/0.5
17000*0.5
setwd("/Users/jcbnunez/Documents/GitHub/Cville-Seasonality-2016-2019/REPRODUCIBLE_FIGURES/Fig4")
rm(list = ls())
library(data.table)
library(tidyverse)
library(magrittr)
library(foreach)
library(doMC)
registerDoMC(4)
library(tidyr)
library(patchwork)
####  create window objects
final.windows.pos =
data.frame(win.name = c("left", "win_3.1", "win_4.7", "win_5.1", "win_6.1", "win_6.8", "win_9.6", "right" ),
mid = c(2.2, 3.0, 4.67, 5.12, 6.2, 6.8 , 9.6, 13.1),
chr = "2L"
) %>%
mutate(start = (mid-0.2)*1e6 ,
end  = (mid+0.2)*1e6  )
### load thermal GLM object
sets <- data.table(mod=c(1:11),
start=c(0,  0,  0,  7, 15, 30, 60, 15, 45,  0,  0),
end=	 c(7, 15, 30, 15, 30, 60, 90, 45, 75, 60, 90))
####### PLot
load("./window.enrich.set.Rdata")
#load("./machado.datasets.enrch.Rdata")
rbind(
#mutate(machado.datasets.enrch, set.type = "Machado"  ),
mutate(enrichment.sets, set.type = "DEST")) %>%
#filter(analysis_type == "best_model") %>%
#separate(anchor.model, into = c("model", "resolution.mod", "demo.region"), sep = ";" ) %>%
mutate(start=win.start,
end=win.end
) %>%      left_join(final.windows.pos) %>%
ggplot(aes(
x=win.name,
y=log2(or),
ymin=log2(lci),
ymax=log2(uci),
color = anchor.model,
fill = anchor.model,
)) +
geom_hline(yintercept = 0, linetype = "dashed") +
geom_errorbar(size = 0.5, width = 0.25, position=position_dodge(width=0.5)) +
geom_point(size = 2.0, shape = 21, position=position_dodge(width=0.5), color = "black") +
theme_bw() +
facet_grid(set.type~., scales = "free_y") +
theme(legend.pos = "none")
enrich.plot
rbind(
#mutate(machado.datasets.enrch, set.type = "Machado"  ),
mutate(enrichment.sets, set.type = "DEST"))
rbind(
mutate(machado.datasets.enrch, set.type = "Machado"  ),
mutate(enrichment.sets, set.type = "DEST"))
load("./machado.datasets.enrch.Rdata")
machado.datasets.enrch
rbind(
mutate(machado.datasets.enrch, set.type = "Machado"  ),
mutate(enrichment.sets, set.type = "DEST")) %>%
#filter(analysis_type == "best_model") %>%
#separate(anchor.model, into = c("model", "resolution.mod", "demo.region"), sep = ";" ) %>%
mutate(start=win.start,
end=win.end
) %>%      left_join(final.windows.pos) %>%
ggplot(aes(
x=win.name,
y=log2(or),
ymin=log2(lci),
ymax=log2(uci),
color = anchor.model,
fill = anchor.model,
)) +
geom_hline(yintercept = 0, linetype = "dashed") +
geom_errorbar(size = 0.5, width = 0.25, position=position_dodge(width=0.5)) +
geom_point(size = 2.0, shape = 21, position=position_dodge(width=0.5), color = "black") +
theme_bw() +
facet_grid(set.type~., scales = "free_y") +
theme(legend.pos = "none") ->
enrich.plot
enrich.plot
rbind(
mutate(machado.datasets.enrch, set.type = "Machado"  ),
mutate(enrichment.sets, set.type = "DEST")) %>%
mutate(start=win.start,end=win.end) %>%
left_join(final.windows.pos) %>%
ggplot(aes(
x=win.name,
y=st.pr,
ymin=st.lci,
ymax=st.uci,
color = anchor.model,
fill = anchor.model,
)) +
geom_hline(yintercept = 0.5) +
geom_errorbar(size = 0.5, width = 0.25, position=position_dodge(width=0.5)) +
geom_point(size = 2.0, shape = 21, position=position_dodge(width=0.5), color = "black") +
theme_bw() +
facet_grid(set.type~., scales = "free_y") +
theme(legend.pos = "bottom") +
ylab("Directionality") ->
dir.plot
dir.plot
1000*0.04
20000*0.04
20000*0.045
