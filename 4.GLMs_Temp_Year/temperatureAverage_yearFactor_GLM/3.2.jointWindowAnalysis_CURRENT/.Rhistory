load("/scratch/yey2sn/Overwintering_ms/7.LD/GLM_LD_outlier_AFs_annot.Rdata")
load("/scratch/yey2sn/Overwintering_ms/7.LD/ld_df_intermediate_step.Rdata")
annotation_set
library(tidyverse)
library(tidyverse)
CM_predictions_parsed %>%
group_by(date_parsed, karyot, set) %>%
summarise(N = n()) %>% tail
CM_predictions %>%
separate(line_name, into = c("set", "id", "date"), sep = "_") %>%
mutate(date_parsed = case_when( date %in% c("CMspring") ~ as.Date("06/01/2018", format = "%m/%d/%Y"),
date %in% c("CMfall") ~ as.Date("09/01/2017", format = "%m/%d/%Y"),
!(date %in% c("CMspring", "CMfall")) ~ as.Date(paste(date, 2016, sep = ""), format = "%m%d%Y"))) %>%
mutate(karyot = case_when(SVM >= 0.90 ~ "Inv/Inv",
SVM <= 0.10 ~ "Std/Std",
SVM > 0.10 | SVM < 0.90 ~ "Std/Inv" ) ) %>%
mutate(inv_freq = case_when(karyot == "Inv/Inv" ~ 2,
karyot == "Std/Std" ~ 0,
karyot == "Std/Inv" ~ 1) ) %>%
mutate(Group = case_when(set == "CM" ~ "Alys",
set != "CM" ~ "Pris",) ) ->
CM_predictions_parsed
left_join(tots, counts )
?write.table()
write.table(STD_samps, file = "STD_samps.txt",
quote = FALSE, sep = "\t",
row.names = FALSE,
col.names = FALSE)q
mask_info <- fread("/project/berglandlab/jcbnunez/Cville_2lt_haps/Retain_loci_metadat.txt")
mask_info %<>%
mutate(adj_pos = pos_adj_scalar-2225744+1)
2051600-2051609
163+145+27
538-100
435-335
28+6+8+8+15+14+17+2+2
fread
library(dplyer)
library(dplyr)
snp_dat_table_loc %>%
as.data.frame %>%
mutate(samp=rownames(.)) %>%
separate(samp, into = c("samp","haplo"), sep = "\\.") %>%
left_join(homozyg_samps) ->
snp_dat_table_loc_meta
snp_dat_table_loc_meta %>%
dplyr::select(-samp, -haplo, -inv_st) %>%
PCA(.,
graph = FALSE,
scale.unit = F,
ncp=20 ) -> pca_fig_std
pca_fig_std$ind$coord %>%
as.data.frame %>%
cbind(., snp_dat_table_loc_meta[,c("samp", "haplo", "inv_st")]) %>%
ggplot(aes(
x=Dim.1,
y=Dim.2,
color = haplo,
shape = inv_st
)) +
geom_point() -> pca_gg_figure
ggsave(pca_gg_figure, file = "pca_gg_figure.pdf")
snp_dat_table_loc %>%
as.data.frame %>%
mutate(samp=rownames(.)) %>%
separate(samp, into = c("samp","haplo"), sep = "\\.") %>%
filter(inv_st %in% c("Std", "Inv")) %>%
left_join(metadata_tab) ->
snp_dat_table_loc_meta
snp_dat_table_loc_meta %>%
dplyr::select(-samp, -haplo, -inv_st) %>%
PCA(.,
graph = FALSE,
scale.unit = F,
ncp=20 ) -> pca_fig_std
pca_fig_std$ind$coord %>%
as.data.frame %>%
cbind(., snp_dat_table_loc_meta[,c("samp", "haplo", "inv_st")]) %>%
ggplot(aes(
x=Dim.1,
y=Dim.3,
color = haplo,
shape = inv_st
)) +
geom_point() -> pca_gg_figure
ggsave(pca_gg_figure, file = "pca_gg_figure.pdf")
glm_ld_markers <- fasta2DNAbin("/project/berglandlab/jcbnunez/Cville_2lt_haps/Homozyg_only_GlmOnly_OutlierInvs_rm.fa",
quiet=FALSE, chunkSize=10, snpOnly=FALSE)
snp_metadat <- fread("/project/berglandlab/jcbnunez/Cville_2lt_haps/Retain_loci_metadat.txt")
#the begining of inv2Lt
pos_adj_scalar = 2051600
homozyg_samps <- fread("/project/berglandlab/jcbnunez/Cville_2lt_haps/Homozyg_samps_metadat.txt", header=F)
names(homozyg_samps) = c("samp","inv_st")
het_samps <- fread("/project/berglandlab/jcbnunez/Cville_2lt_haps/Het_samps_metadat.txt", header=F)
names(het_samps) = c("samp","inv_st")
rbind(homozyg_samps, het_samps) -> metadata_tab
marker="Inv_right"
mask_info_inv_r = mask_info.all %>%
filter(V3 %in% c("inv"),
V2 > 6e6)
homozyg_samps <- fread("/project/berglandlab/jcbnunez/Cville_2lt_haps/Homozyg_samps_metadat.txt", header=F)
names(homozyg_samps) = c("samp","inv_st")
het_samps <- fread("/project/berglandlab/jcbnunez/Cville_2lt_haps/Het_samps_metadat.txt", header=F)
names(het_samps) = c("samp","inv_st")
rbind(homozyg_samps, het_samps) -> metadata_tab
mask_info.all <- fread("/project/berglandlab/jcbnunez/Cville_2lt_haps/Retain_loci_metadat.txt")
mask_info.all %<>%
mutate(adj_pos = V2-pos_adj_scalar+1)
snp_metadat %>%
filter(V3 %in% c("inv",  "glm")) ->
glm_snps_meta
names(glm_snps_meta) = c("chr", "pos", "type")
DNAStr_glm
dimdesc
?
dimdesc
FactoMineR::dimdesc(pca_fig_std, proba = 1.0) -> pca_fig_std_dimdesc
rbind(
data.frame(pca_fig_std_dimdesc$Dim.1$quanti, Dim = 1, mask_info.all),
data.frame(pca_fig_std_dimdesc$Dim.2$quanti, Dim = 2, mask_info.all),
data.frame(pca_fig_std_dimdesc$Dim.2$quanti, Dim = 3, mask_info.all)
) %>% head
rbind(
data.frame(pca_fig_std_dimdesc$Dim.1$quanti, Dim = 1, mask_info.all),
data.frame(pca_fig_std_dimdesc$Dim.2$quanti, Dim = 2, mask_info.all),
data.frame(pca_fig_std_dimdesc$Dim.2$quanti, Dim = 3, mask_info.all)
) %>%
dplyr::select( p.value, Dim, chr,     pos, type, adj_pos) %>% head
pca_fig_std$var$contrib %>%
as.data.frame() %>%
cbind(mask_info.all) %>%
melt(id = c(chr, pos, type,adj_pos)) %>% head
?fasta2DNAbin
names(inv2lt_seq)
dna_seq
####
#### hap net
vcfR2DNAbin
?read.vcfR
vcfR2DNAbin
####
################
################v
#### hap net
vcf <- read.vcfR("./CMsamps_GLM_LD.recode.vcf.gz", verbose = FALSE)
####
library(tidyverse)
library(magrittr)
library(factoextra)
library(FactoMineR)
library(adegenet)
library(data.table)
library(reshape2)
library(pegas)
library(vcfR)
### load samp info
homozyg_samps <- fread("./Homozyg_samps_metadat.txt", header=F)
names(homozyg_samps) = c("samp","inv_st")
het_samps <- fread("./Het_samps_metadat.txt", header=F)
names(het_samps) = c("samp","inv_st")
rbind(homozyg_samps, het_samps) -> metadata_tab
glm_ld_markers <- fasta2DNAbin("./Homozyg_only.GlmInv.fa",
quiet=FALSE, chunkSize=10, snpOnly=FALSE)
glm_ld_markers_gen = DNAbin2genind(x = glm_ld_markers, polyThres = 0.00)
glm_ld_markers_gen@tab %>%
as.data.frame -> snp_dat_table
snp_dat_table %>% dim
pca_fig_std$ind$coord %>%
as.data.frame %>%
cbind(., metadata_tab) %>% head
ggplot(aes(
x=Dim.1,
y=Dim.2,
color = inv_st
)) +
geom_point() -> pca_gg_figure
ggsave(pca_gg_figure, file = "pca_gg_figure.pdf")
names(cluster[res$cluster == 2])
## Make DNAbin
my_dnabin1 <- vcfR2DNAbin(vcf, consensus = FALSE, extract.haps = TRUE)
###
library(tidyverse)
library(magrittr)
library(factoextra)
library(FactoMineR)
library(adegenet)
library(data.table)
library(reshape2)
library(pegas)
library(vcfR)
### load samp info
homozyg_samps <- fread("./Homozyg_samps_metadat.txt", header=F)
names(homozyg_samps) = c("samp","inv_st")
het_samps <- fread("./Het_samps_metadat.txt", header=F)
names(het_samps) = c("samp","inv_st")
rbind(homozyg_samps, het_samps) -> metadata_tab
?left_join
pca_fig_std$ind$coord %>%
as.data.frame %>%
mutate(samp_hap =  rownames(.)) %>%
mutate(dataset = case_when(
samp_hap %in% rownames(genlight_cm_subset) ~ "CM",
samp_hap %in% rownames(tab(genlight_dgrp)) ~ "DGRP",
)) %>%
left_join(., dgrp_inv_info, na_matches = "no_dgrp") %>% head
dimdesc_object$Dim.1$quanti %>%
data.frame() %>%
mutate(p.value.adj = p.adjust(p.value, method = "bonferroni"),
snp_id = rownames(.)) %>%
separate(snp_id, into = c("chr", "pos", "feature"), sep = "_" ) %>%
ggplot(aes(
x=as.numeric(pos),
y=correlation,
color = correlation
)) +
geom_point() ->
pca_dim1_cor
ggsave(pca_dim1_cor, file = "pca_dim1_cor.pdf")
dimdesc_object$Dim.1$quanti %>%
data.frame() %>%
mutate(p.value.adj = p.adjust(p.value, method = "bonferroni"),
snp_id = rownames(.)) %>%
separate(snp_id, into = c("chr", "pos", "feature"), sep = "_" ) %>%
filter(p.value.adj < 0.05) %>%
ggplot(aes(
x=as.numeric(pos),
y=correlation^2,
color = correlation^2
)) +
geom_point() +
scale_color_gradient2(midpoint = 0.5) ->
pca_dim1_cor
ggsave(pca_dim1_cor, file = "pca_dim1_cor.pdf")
dimdesc_object$Dim.1$quanti %>%
data.frame() %>%
mutate(p.value.adj = p.adjust(p.value, method = "bonferroni"),
snp_id = rownames(.)) %>%
separate(snp_id, into = c("chr", "pos", "feature"), sep = "_" ) %>%
filter(p.value.adj < 0.05) %>%
ggplot(aes(
x=as.numeric(pos),
y=correlation^2,
color = correlation^2
)) +
geom_point() +
scale_color_gradient2(midpoint = 0.5) ->
pca_dim1_cor
ggsave(pca_dim1_cor, file = "pca_dim1_cor.pdf")
dimdesc_object$Dim.1$quanti %>%
data.frame() %>%
mutate(p.value.adj = p.adjust(p.value, method = "bonferroni"),
snp_id = rownames(.)) %>%
separate(snp_id, into = c("chr", "pos", "feature"), sep = "_" ) %>%
filter(p.value.adj < 0.05) %>%
ggplot(aes(
x=as.numeric(pos),
y=correlation^2,
color = correlation^2
)) +
geom_point() +
geom_hline(yintercept = 0.85) +
scale_color_gradient2(low= "red", mid = "purple", high = "blue", midpoint = 0.5 ) +
annotate("text", x = 5e6, y = 0.87, label = "Inversion Marker Threshold") ->
pca_dim1_cor
ggsave(pca_dim1_cor, file = "pca_dim1_cor.pdf", w=6, h= 4)
PCA_dat_parsed %>%
filter(p.value.adj < 0.01,
correlation^2 > 0.85) ->
inversion_markers
